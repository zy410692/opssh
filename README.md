# opssh
运维日常的脚本


1 gc.sh 
为k8s环境的pod提供gc.log和堆栈信息


2 mysqlapi.py
为mysql提供创建数据库、用户、分配权限的脚本
test_mysqlapi.py 为mysqlapi.py提供测试用例


3 

## 使用方法

1. 配置钉钉机器人
   - 在钉钉群中添加自定义机器人
   - 获取 webhook 地址和加签密钥
   - 将获取到的信息填入配置项

2. 调整监控阈值
   - 根据服务器实际情况修改 `loadThreshold` 值

3. 运行程序
   ```bash
   go run topmonitor.go
   ```

## 定时任务说明

程序默认每小时执行一次监控检查（`0 0 * * * *`）。可以通过修改 cron 表达式来调整执行频率：

- `"*/30 * * * * *"` - 每30秒执行一次
- `"0 */30 * * * *"` - 每30分钟执行一次
- `"0 0 */2 * * *"` - 每2小时执行一次

## 告警信息

当系统负载超过阈值时，钉钉机器人会发送包含以下信息的告警：

- 当前系统负载
- 告警阈值
- 告警时间

## 注意事项

1. 确保服务器能够访问钉钉 API
2. 妥善保管钉钉机器人的 token 和 secret
3. 根据实际需求调整监控频率和负载阈值